steps:
  # Bước 1: Cài đặt các package cho NestJS bằng Yarn và sử dụng cache
  - name: 'node:20'
    entrypoint: 'yarn'
    args: ['install']
    volumes:
      - name: 'yarn-cache'
        path: '/root/.cache/yarn'

  # Bước 2: Build ứng dụng với Yarn
  - name: 'node:20'
    entrypoint: 'yarn'
    args: ['build']
    volumes:
      - name: 'yarn-cache'
        path: '/root/.cache/yarn'

  # Bước 3: Triển khai ứng dụng lên Google App Engine
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['app', 'deploy']

options:
  logging: CLOUD_LOGGING_ONLY

# Cấu hình cache
cache:
  paths:
    - '/root/.cache/yarn' # Cache Yarn cache
    - 'node_modules/'      # Cache node_modules nếu cần
